import{a as D,u as n,j as e}from"./index-YmJ5rGxO.js";import{r as m}from"./vendor-redux-FsoCpCcR.js";import{c as Y,u as F,L as k}from"./vendor-react-BGYP6dvN.js";import{C as p,a as x,b as h,d as b,c as J}from"./card-C1Os2Jzs.js";import{B as c}from"./button-BZ__ZVvs.js";import{B as $}from"./badge-dOlDYKGI.js";import{S as B,a as q,b as z,c as K,d as Q}from"./select-CkWAxkRE.js";import{f as P}from"./currencyUtils-CJd_f-r_.js";import{c as X}from"./utils-Ckn0VQvi.js";import{A as Z}from"./arrow-left-BKxa5Psn.js";import{U as ee}from"./user-B5foYKLX.js";import{C as se}from"./car-BlMH6bVL.js";import{M as L}from"./message-circle-DvhV2ynm.js";import{c as te}from"./createLucideIcon-BRnZLpr8.js";import{f as W}from"./format-CzBVktxt.js";import"./vendor-recharts-Bkxxru1U.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=te("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),ae={RECEIVED:"received",IN_PROGRESS:"inProgress",WASHING:"washing",DRYING:"drying",COMPLETED:"completed",DELIVERED:"delivered"};function ne(a){return!a||typeof a!="string"?"":a.replace(/\D/g,"").trim()}function le(a,{name:u="",vehicleNumber:s="",token:f=""}){return a?a.replace(/\{\{name\}\}/g,String(u)).replace(/\{\{vehicleNumber\}\}/g,String(s)).replace(/\{\{token\}\}/g,String(f)):""}const oe={RECEIVED:"bg-sky-50 text-sky-700 border border-sky-100",IN_PROGRESS:"bg-amber-50 text-amber-700 border border-amber-100",WASHING:"bg-violet-50 text-violet-700 border border-violet-100",DRYING:"bg-indigo-50 text-indigo-700 border border-indigo-100",COMPLETED:"bg-emerald-50 text-emerald-700 border border-emerald-100",DELIVERED:"bg-slate-100 text-slate-700 border border-slate-200",CANCELLED:"bg-red-50 text-red-700 border border-red-100"},ie=[{value:"IN_PROGRESS",label:"In Progress"},{value:"WASHING",label:"Washing"},{value:"DRYING",label:"Drying"},{value:"COMPLETED",label:"Completed"},{value:"DELIVERED",label:"Delivered"},{value:"CANCELLED",label:"Cancelled"}];function Ie(){const{id:a}=Y(),u=F(),[s,f]=m.useState(null),[l,w]=m.useState(null),[G,T]=m.useState(!0),[g,I]=m.useState(!1),[j,N]=m.useState("");m.useEffect(()=>{a&&y()},[a]);const y=async()=>{try{const[t,r]=await Promise.all([D.get(`/admin/jobs/${a}`),D.get("/admin/settings").catch(()=>({data:{}}))]);t.data.success?(f(t.data.job),N(t.data.job.status)):(n.error("Failed to load job"),u("/admin/jobs")),r?.data?.success&&r.data.settings?w(r.data.settings):w({})}catch(t){console.error("Failed to load job:",t),n.error(t.response?.data?.message||"Failed to load job"),u("/admin/jobs")}finally{T(!1)}},O=()=>y(),R=async t=>{const r=t??j;if(!(!r||r===s.status)){I(!0);try{(await D.patch(`/admin/jobs/${a}/status`,{status:r})).data.success?(n.success("Job status updated successfully!"),N(r),O()):n.error("Failed to update job status")}catch(i){console.error("Update job status error:",i),n.error(i.response?.data?.message||"Failed to update job status")}finally{I(!1)}}},M=s?.customerId?.whatsappNumber||s?.customerId?.phone||"",o=ne(M),v=!!l?.shopWhatsappNumber?.trim(),_=l?.whatsappTemplates||{},C=s?ae[s.status]:null,E=C&&_[C]||"",S=v&&o&&E,A=()=>{if(!S)return;const t=s.customerId?.name||"",r=s.carId?.carNumber||"",i=s.tokenNumber||"",U=le(E,{name:t,vehicleNumber:r,token:i}),H=`https://wa.me/${o}?text=${encodeURIComponent(U)}`;window.open(H,"_blank","noopener,noreferrer"),n.success("WhatsApp opened. Send the message to the customer.")},V=()=>{const t=l?.googleReviewLink?.trim();if(!t){n.error("Google Review link not set. Add it in WhatsApp Settings.");return}if(!o){n.error("Customer phone number is missing.");return}const r=`Thank you for choosing us ðŸ™
Please leave us a Google review: ${t}`,i=`https://wa.me/${o}?text=${encodeURIComponent(r)}`;window.open(i,"_blank","noopener,noreferrer"),n.success("WhatsApp opened. Send the review request to the customer.")};if(G)return e.jsx("div",{className:"flex items-center justify-center min-h-[40vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-2 border-primary border-t-transparent"})});if(!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{children:"Job not found"}),e.jsx(k,{to:"/admin/jobs",children:e.jsx(c,{children:"Back to Jobs"})})]});const d=(t=>({RECEIVED:"IN_PROGRESS",IN_PROGRESS:"WASHING",WASHING:"DRYING",DRYING:"COMPLETED",COMPLETED:"DELIVERED"})[t])(s.status);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(k,{to:"/admin/jobs",className:"min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(c,{variant:"ghost",size:"icon",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-800",children:"Job Details"}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Token: ",s.tokenNumber]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(h,{children:"Job Information"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-border/60",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx($,{className:X("rounded-md",oe[s.status]||""),children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-border/60",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Token Number"}),e.jsx("span",{className:"font-medium text-slate-800",children:s.tokenNumber})]}),e.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-border/60",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Price"}),e.jsx("span",{className:"text-xl font-semibold text-primary",children:P(Number(s.totalPrice),l?.currency)})]}),s.estimatedDelivery&&e.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-border/60",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Estimated Delivery"}),e.jsx("span",{className:"font-medium",children:W(new Date(s.estimatedDelivery),"PPp")})]}),s.actualDelivery&&e.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-border/60",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Actual Delivery"}),e.jsx("span",{className:"font-medium",children:W(new Date(s.actualDelivery),"PPp")})]})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(h,{children:"Customer & Car"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerId?.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.customerId?.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.carId?.carNumber}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.carId?.brand," ",s.carId?.model," ",s.carId?.color&&`â€¢ ${s.carId.color}`]})]})]})]})]}),e.jsxs(p,{className:"md:col-span-2",children:[e.jsx(x,{children:e.jsx(h,{children:"Services"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:s.services&&s.services.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-2 border-b border-border/60 last:border-0 rounded-md hover:bg-muted/50 transition-colors",children:[e.jsx("span",{className:"text-slate-700",children:t.serviceId?.name||"Service"}),e.jsx("span",{className:"font-medium text-slate-800",children:P(Number(t.price),l?.currency)})]},r))})})]}),e.jsxs(p,{className:"md:col-span-2",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Status & WhatsApp"}),e.jsx(J,{children:"Update job status and send status messages to the customer via WhatsApp (click-to-chat)."})]}),e.jsxs(b,{className:"space-y-4",children:[s.status!=="DELIVERED"&&s.status!=="CANCELLED"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(B,{value:j,onValueChange:N,children:[e.jsx(q,{className:"w-full sm:flex-1",children:e.jsx(z,{})}),e.jsx(K,{children:ie.filter(t=>s.status==="RECEIVED"?t.value==="IN_PROGRESS":s.status==="IN_PROGRESS"?t.value==="WASHING":s.status==="WASHING"?t.value==="DRYING":s.status==="DRYING"?t.value==="COMPLETED":s.status==="COMPLETED"?t.value==="DELIVERED":!1).map(t=>e.jsx(Q,{value:t.value,children:t.label},t.value))})]}),e.jsx(c,{onClick:R,disabled:g||j===s.status,className:"w-full sm:w-auto",children:g?"Updating...":"Update Status"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(c,{onClick:()=>R(d),disabled:g,className:"w-full sm:flex-1",children:[d==="IN_PROGRESS"&&"â–¶ Mark In Progress",d==="WASHING"&&"â–¶ Mark Washing",d==="DRYING"&&"â–¶ Mark Drying",d==="COMPLETED"&&"âœ… Mark Completed",d==="DELIVERED"&&"ðŸš— Mark Delivered"]}),e.jsxs(c,{variant:"outline",onClick:A,disabled:!S,className:"w-full sm:flex-1 bg-[#25D366]/10 text-[#25D366] hover:bg-[#25D366]/20 border-[#25D366]/30",title:v?o?E?"Open WhatsApp with pre-filled message":"Template empty in WhatsApp Settings":"Customer phone missing":"Add Shop WhatsApp number in WhatsApp Settings",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Send ",s.status.replace("_"," ")," WhatsApp"]})]})]}),s.status==="DELIVERED"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(c,{variant:"outline",onClick:A,disabled:!S,className:"w-full sm:flex-1 bg-[#25D366]/10 text-[#25D366] hover:bg-[#25D366]/20 border-[#25D366]/30",title:v?o?"Open WhatsApp":"Customer phone missing":"Add Shop WhatsApp number in WhatsApp Settings",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Send Delivered WhatsApp"]}),e.jsxs(c,{onClick:V,disabled:!o||!l?.googleReviewLink?.trim(),className:"w-full sm:flex-1 bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200",title:l?.googleReviewLink?.trim()?"Open WhatsApp with review request":"Add Google Review link in WhatsApp Settings",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Ask for Google Review"]})]})]})]})]})]})}export{Ie as default};
