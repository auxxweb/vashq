import{a as p,u as o,j as e}from"./index-YmJ5rGxO.js";import{r as l}from"./vendor-redux-FsoCpCcR.js";import{C as N,d as C,a as ae,b as re}from"./card-C1Os2Jzs.js";import{B as n}from"./button-BZ__ZVvs.js";import{I as i}from"./input-lKSy0GOu.js";import{L as c}from"./label-C0QsUGTD.js";import{D as U,a as V,b as $,c as K,d as M}from"./dialog-DioR_SNv.js";import{S as A,a as I,b as P,c as k,d as b}from"./select-CkWAxkRE.js";import{p as R}from"./formUtils-CjVQbo5F.js";import{P as te}from"./plus-BOAFu-8E.js";import{S as H}from"./search-yXlgkkGt.js";import{P as le}from"./pen-square-DESXZr50.js";import{T as oe}from"./trash-2-CyIO3SZl.js";import{C as ne,a as ce}from"./chevron-right-Uxjaubls.js";import"./vendor-react-BGYP6dvN.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";import"./createLucideIcon-BRnZLpr8.js";const E=12;function Le(){const[j,G]=l.useState([]),[y,Z]=l.useState([]),[_,z]=l.useState(!0),[u,S]=l.useState(""),[O,w]=l.useState(""),[m,F]=l.useState("ALL"),[d,h]=l.useState(1),[x,J]=l.useState({total:0,totalPages:0}),[Q,g]=l.useState(!1),[W,f]=l.useState(!1),[T,L]=l.useState(null),[a,t]=l.useState({customerId:"",carNumber:"",brand:"",model:"",color:"",notes:""});l.useEffect(()=>{v()},[u,m,d]),l.useEffect(()=>{p.get("/admin/customers?limit=500").then(s=>{s.data?.success&&Z(s.data.customers||[])}).catch(()=>{})},[]);const v=async()=>{z(!0);try{const s=new URLSearchParams;s.set("page",String(d)),s.set("limit",String(E)),u.trim()&&s.set("search",u.trim()),m&&m!=="ALL"&&s.set("customerId",m);const r=await p.get(`/admin/cars?${s.toString()}`);r.data.success?(G(r.data.cars||[]),r.data.pagination&&J({total:r.data.pagination.total,totalPages:r.data.pagination.totalPages})):o.error("Failed to load cars")}catch(s){console.error("Failed to load cars:",s),o.error(s.response?.data?.message||"Failed to load cars")}finally{z(!1)}},q=s=>{s?.preventDefault(),S(O),h(1)},B=s=>{s<1||s>x.totalPages||h(s)},X=async s=>{if(s.preventDefault(),!a.customerId||!a.carNumber){o.error("Please select a customer and enter car number");return}try{(await p.post("/admin/cars",a)).data.success?(o.success("Car added successfully!"),g(!1),D(),v()):o.error("Failed to add car")}catch(r){console.error("Add car error:",r),o.error(r.response?.data?.message||"Failed to add car")}},Y=async s=>{if(s.preventDefault(),!!T)try{(await p.put(`/admin/cars/${T._id}`,a)).data.success?(o.success("Car updated successfully!"),f(!1),L(null),D(),v()):o.error("Failed to update car")}catch(r){console.error("Update car error:",r),o.error(r.response?.data?.message||"Failed to update car")}},ee=s=>{L(s),t({customerId:s.customerId?._id||s.customerId||"",carNumber:s.carNumber,brand:s.brand||"",model:s.model||"",color:s.color||"",notes:s.notes||""}),f(!0)},se=async s=>{if(confirm("Are you sure you want to delete this car?"))try{(await p.delete(`/admin/cars/${s}`)).data.success?(o.success("Car deleted successfully!"),v()):o.error("Failed to delete car")}catch(r){console.error("Delete car error:",r),o.error(r.response?.data?.message||"Failed to delete car")}},D=()=>{t({customerId:"",carNumber:"",brand:"",model:"",color:"",notes:""})};return _?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Cars"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer cars"})]}),e.jsxs(n,{onClick:()=>{D(),g(!0)},children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Add Car"]})]}),e.jsx(N,{children:e.jsx(C,{className:"p-6",children:e.jsxs("form",{onSubmit:q,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search by car number, brand, model, color, or customer...",value:O,onChange:s=>w(s.target.value),onKeyDown:s=>s.key==="Enter"&&q(s),className:"pl-9"})]}),e.jsx(n,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(A,{value:m,onValueChange:s=>{F(s),h(1)},children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(P,{placeholder:"All customers"})}),e.jsxs(k,{children:[e.jsx(b,{value:"ALL",children:"All customers"}),y.map(s=>e.jsxs(b,{value:s._id,children:[s.name," – ",s.phone]},s._id))]})]}),(u||m!=="ALL")&&e.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>{S(""),w(""),F("ALL"),h(1)},children:"Clear"})]})]})})}),e.jsx(U,{open:Q,onOpenChange:g,children:e.jsxs(V,{children:[e.jsxs($,{children:[e.jsx(K,{children:"Add New Car"}),e.jsx(M,{children:"Add a car for a customer"})]}),e.jsxs("form",{onSubmit:X,onKeyDown:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Customer *"}),e.jsxs(A,{value:a.customerId,onValueChange:s=>t({...a,customerId:s}),required:!0,children:[e.jsx(I,{children:e.jsx(P,{placeholder:"Select customer"})}),e.jsx(k,{children:y.map(s=>e.jsxs(b,{value:s._id,children:[s.name," - ",s.phone]},s._id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"carNumber",children:"Car Number *"}),e.jsx(i,{id:"carNumber",value:a.carNumber,onChange:s=>t({...a,carNumber:s.target.value}),placeholder:"e.g. ABC-1234",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"brand",children:"Brand"}),e.jsx(i,{id:"brand",value:a.brand,onChange:s=>t({...a,brand:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"model",children:"Model"}),e.jsx(i,{id:"model",value:a.model,onChange:s=>t({...a,model:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"color",children:"Color"}),e.jsx(i,{id:"color",value:a.color,onChange:s=>t({...a,color:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Notes"}),e.jsx(i,{id:"notes",value:a.notes,onChange:s=>t({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(n,{type:"submit",children:"Add Car"})]})]})]})}),e.jsx(U,{open:W,onOpenChange:f,children:e.jsxs(V,{children:[e.jsxs($,{children:[e.jsx(K,{children:"Edit Car"}),e.jsx(M,{children:"Update car details"})]}),e.jsxs("form",{onSubmit:Y,onKeyDown:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Customer *"}),e.jsxs(A,{value:a.customerId,onValueChange:s=>t({...a,customerId:s}),required:!0,children:[e.jsx(I,{children:e.jsx(P,{placeholder:"Select customer"})}),e.jsx(k,{children:y.map(s=>e.jsxs(b,{value:s._id,children:[s.name," - ",s.phone]},s._id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-carNumber",children:"Car Number *"}),e.jsx(i,{id:"edit-carNumber",value:a.carNumber,onChange:s=>t({...a,carNumber:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-brand",children:"Brand"}),e.jsx(i,{id:"edit-brand",value:a.brand,onChange:s=>t({...a,brand:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-model",children:"Model"}),e.jsx(i,{id:"edit-model",value:a.model,onChange:s=>t({...a,model:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-color",children:"Color"}),e.jsx(i,{id:"edit-color",value:a.color,onChange:s=>t({...a,color:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(i,{id:"edit-notes",value:a.notes,onChange:s=>t({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>{f(!1),L(null)},children:"Cancel"}),e.jsx(n,{type:"submit",children:"Update Car"})]})]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[j.length===0&&!_&&e.jsx(N,{className:"md:col-span-2 lg:col-span-3",children:e.jsxs(C,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:u||m!=="ALL"?"No cars match your search or filter.":"No cars yet. Add your first car to get started."}),(u||m!=="ALL")&&e.jsx(n,{className:"mt-4",variant:"outline",onClick:()=>{S(""),w(""),F("ALL"),h(1)},children:"Clear"})]})}),j.map(s=>e.jsxs(N,{children:[e.jsx(ae,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(re,{children:s.carNumber}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>ee(s),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>se(s._id),children:e.jsx(oe,{className:"h-4 w-4"})})]})]})}),e.jsxs(C,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.brand," ",s.model," ",s.color&&`• ${s.color}`]}),s.customerId&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Customer: ",typeof s.customerId=="object"?s.customerId?.name:"-"]})]})]},s._id))]}),x.totalPages>1&&e.jsx(N,{children:e.jsx(C,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",j.length===0?0:(d-1)*E+1,"–",(d-1)*E+j.length," of ",x.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>B(d-1),disabled:d<=1,children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",d," of ",x.totalPages]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>B(d+1),disabled:d>=x.totalPages,children:["Next",e.jsx(ce,{className:"h-4 w-4 ml-1"})]})]})]})})})]})}export{Le as default};
