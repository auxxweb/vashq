import{a as p,u as x,j as e}from"./index-YmJ5rGxO.js";import{r}from"./vendor-redux-FsoCpCcR.js";import{C as v,a as F,b as I,c as U,d as q}from"./card-C1Os2Jzs.js";import{B as D}from"./button-BZ__ZVvs.js";import"./input-lKSy0GOu.js";import{L as Z}from"./label-C0QsUGTD.js";import{T as J}from"./textarea-CojeXS5Z.js";import{D as Q,a as $,b as ee,c as se,d as te}from"./dialog-DioR_SNv.js";import{B as ae}from"./badge-dOlDYKGI.js";import{p as ne}from"./formUtils-CjVQbo5F.js";import{f as _}from"./currencyUtils-CJd_f-r_.js";import{L as k}from"./loader-2-Z6OQyPns.js";import{t as A,d as re,f as Y}from"./format-CzBVktxt.js";import{c as ie}from"./createLucideIcon-BRnZLpr8.js";import"./vendor-react-BGYP6dvN.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=ie("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function de(t,i){const n=A(t),d=A(i),c=B(n,d),o=Math.abs(re(n,d));n.setDate(n.getDate()-c*o);const g=+(B(n,d)===-c),u=c*(o-g);return u===0?0:u}function B(t,i){const n=t.getFullYear()-i.getFullYear()||t.getMonth()-i.getMonth()||t.getDate()-i.getDate()||t.getHours()-i.getHours()||t.getMinutes()-i.getMinutes()||t.getSeconds()-i.getSeconds()||t.getMilliseconds()-i.getMilliseconds();return n<0?-1:n>0?1:n}function Pe(){const[t,i]=r.useState(null),[n,d]=r.useState([]),[c,o]=r.useState(null),[g,u]=r.useState(!0),[S,H]=r.useState("USD"),[T,L]=r.useState(!0),[O,h]=r.useState(!1),[P,C]=r.useState(""),[w,j]=r.useState(""),[M,R]=r.useState(!1);r.useEffect(()=>{z()},[]),r.useEffect(()=>{p.get("/admin/settings").then(s=>{s.data?.success&&s.data.settings?.currency&&H(s.data.settings.currency)}).catch(()=>{})},[]);const z=async()=>{try{const[s,a]=await Promise.all([p.get("/admin/my-subscription"),p.get("/admin/available-plans")]);s.data.success&&(i(s.data.subscription),u(s.data.canRequestUpgrade!==!1)),a.data.success&&d(a.data.plans||[]);const f=await p.get("/admin/upgrade-requests").catch(()=>({}));if(f.data?.requests){const N=f.data.requests.find(X=>X.status==="PENDING");o(N||null)}}catch(s){x.error(s.response?.data?.message||"Failed to load plan data")}finally{L(!1)}},W=async s=>{if(s.preventDefault(),!P){x.error("Select a plan");return}R(!0);try{const a=await p.post("/admin/upgrade-request",{requestedPlanId:P,message:w||void 0});a.data.success?(x.success("Upgrade request submitted. Pending admin approval."),h(!1),C(""),j(""),o(a.data.request),u(!1)):x.error(a.data.message||"Failed to submit request")}catch(a){x.error(a.response?.data?.message||"Failed to submit request")}finally{R(!1)}},G=s=>{C(s),j(""),h(!0)};if(T)return e.jsx("div",{className:"flex items-center justify-center min-h-[40vh]",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-muted-foreground"})});const l=t?.planId,E=t?.startDate?new Date(t.startDate):null,m=t?.expiryDate?new Date(t.expiryDate):null,K=m&&m>new Date?de(m,new Date):0,b=t?.status==="EXPIRED",y=!!c,V=!g||y;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-800",children:"My Plan"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-0.5",children:"View your current subscription and request plan upgrades. Admin approval required."})]}),e.jsxs(v,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Current Plan"}),e.jsx(U,{children:"Your active subscription details"})]}),e.jsx(q,{className:"space-y-4",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xl font-semibold text-slate-800",children:l?.name||"—"}),e.jsx(ae,{variant:b?"secondary":"default",className:b?"":"bg-emerald-50 text-emerald-700 border-emerald-100",children:t.status})]}),l?.price!=null&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price:"})," ",e.jsx("span",{className:"font-medium",children:_(l.price,S)})]}),e.jsxs("div",{className:"grid gap-2 text-sm",children:[E&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start date:"})," ",Y(E,"PPP")]}),m&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Expiry date:"})," ",Y(m,"PPP"),!b&&e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",K," days remaining)"]})]})]}),l?.features?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Features"}),e.jsx("ul",{className:"list-disc list-inside text-sm space-y-0.5",children:l.features.map((s,a)=>e.jsx("li",{children:s},a))})]}),y&&e.jsxs("div",{className:"rounded-lg bg-amber-50 border border-amber-100 p-3 text-sm text-amber-800",children:[e.jsx("strong",{children:"Pending upgrade request"})," — Waiting for admin approval. You cannot submit another request until this is processed."]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No subscription found. Contact platform admin."})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-slate-800 mb-1",children:"Available Plans"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Request an upgrade. Admin approval required — no online payment."}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:n.map(s=>{const a=l?._id===s._id;return e.jsxs(v,{className:"transition-shadow duration-150",children:[e.jsxs(F,{children:[e.jsx(I,{className:"text-lg text-slate-800",children:s.name}),e.jsxs(U,{children:[s.validityDays," days validity · ",_(s.price??0,S)]})]}),e.jsxs(q,{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.features?.length>0&&e.jsx("ul",{className:"text-sm list-disc list-inside space-y-0.5",children:s.features.slice(0,5).map((f,N)=>e.jsx("li",{children:f},N))}),e.jsxs(D,{size:"sm",variant:a?"secondary":"default",disabled:a||V,onClick:()=>G(s._id),className:"gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),a?"Current plan":y?"Request pending":g?"Request upgrade":"Upgrade not available"]})]})]},s._id)})}),n.length===0&&e.jsx(v,{children:e.jsx(q,{className:"p-8 text-center text-muted-foreground",children:"No other plans available."})})]}),e.jsx(Q,{open:O,onOpenChange:h,children:e.jsxs($,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Request plan upgrade"}),e.jsx(te,{children:"Your request will be reviewed by the admin. No payment is processed — admin approval required."})]}),e.jsxs("form",{onSubmit:W,onKeyDown:ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"Message to admin (optional)"}),e.jsx(J,{value:w,onChange:s=>j(s.target.value),placeholder:"e.g. We need more capacity for the upcoming season",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(D,{type:"submit",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"})," Submitting..."]}):"Submit request"})]})]})]})})]})}export{Pe as default};
