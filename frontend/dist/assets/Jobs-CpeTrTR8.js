import{a as N,u as m,j as e}from"./index-YmJ5rGxO.js";import{r as t}from"./vendor-redux-FsoCpCcR.js";import{u as V,L as j}from"./vendor-react-BGYP6dvN.js";import{C as x,d as u}from"./card-C1Os2Jzs.js";import{B as l}from"./button-BZ__ZVvs.js";import{B as _}from"./badge-dOlDYKGI.js";import{I as M}from"./input-lKSy0GOu.js";import{S as T,a as J,b as z,c as W,d as B}from"./select-CkWAxkRE.js";import{f as H}from"./currencyUtils-CJd_f-r_.js";import{P as I}from"./plus-BOAFu-8E.js";import{S as L}from"./search-yXlgkkGt.js";import{C as U}from"./car-BlMH6bVL.js";import{C as Y}from"./clock-DaivWXWn.js";import{f as D}from"./format-CzBVktxt.js";import{a as P,C as $}from"./chevron-right-Uxjaubls.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";import"./createLucideIcon-BRnZLpr8.js";const K={RECEIVED:"bg-sky-50 text-sky-700 border border-sky-100",IN_PROGRESS:"bg-amber-50 text-amber-700 border border-amber-100",WASHING:"bg-violet-50 text-violet-700 border border-violet-100",DRYING:"bg-indigo-50 text-indigo-700 border border-indigo-100",COMPLETED:"bg-emerald-50 text-emerald-700 border border-emerald-100",DELIVERED:"bg-slate-100 text-slate-700 border border-slate-200",CANCELLED:"bg-red-50 text-red-700 border border-red-100"},Z=[{value:"ALL",label:"All Statuses"},{value:"RECEIVED",label:"Received"},{value:"IN_PROGRESS",label:"In Progress"},{value:"WASHING",label:"Washing"},{value:"DRYING",label:"Drying"},{value:"COMPLETED",label:"Completed"},{value:"DELIVERED",label:"Delivered"},{value:"CANCELLED",label:"Cancelled"}],v=10;function pe(){V();const[h,R]=t.useState([]),[b,S]=t.useState(!0),[i,p]=t.useState("ALL"),[n,g]=t.useState(""),[E,f]=t.useState(""),[A,k]=t.useState("USD"),[r,c]=t.useState(1),[o,G]=t.useState({total:0,totalPages:0});t.useEffect(()=>{C()},[i,n,r]),t.useEffect(()=>{N.get("/admin/settings").then(s=>{s.data?.success&&s.data.settings?.currency&&k(s.data.settings.currency)}).catch(()=>{})},[]);const C=async()=>{S(!0);try{const s=new URLSearchParams;s.set("status",i),s.set("page",String(r)),s.set("limit",String(v)),n.trim()&&s.set("search",n.trim());const a=await N.get(`/admin/jobs?${s.toString()}`);a.data.success?(R(a.data.jobs||[]),a.data.pagination&&G({total:a.data.pagination.total,totalPages:a.data.pagination.totalPages})):m.error("Failed to load jobs")}catch(s){console.error("Failed to load jobs:",s),m.error(s.response?.data?.message||"Failed to load jobs")}finally{S(!1)}},w=s=>{s?.preventDefault(),g(E),c(1)},y=s=>{s<1||s>o.totalPages||c(s)},F=async(s,a)=>{try{(await N.patch(`/admin/jobs/${s}/status`,{status:a})).data.success?(m.success("Job status updated successfully!"),C()):m.error("Failed to update job status")}catch(d){console.error("Update job status error:",d),m.error(d.response?.data?.message||"Failed to update job status")}},O=s=>({RECEIVED:"IN_PROGRESS",IN_PROGRESS:"WASHING",WASHING:"DRYING",DRYING:"COMPLETED",COMPLETED:"DELIVERED"})[s];return b?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 w-48 bg-muted rounded-lg animate-pulse"}),e.jsx("div",{className:"grid gap-4",children:[1,2,3].map(s=>e.jsx(x,{className:"animate-pulse",children:e.jsx(u,{className:"p-6 h-24"})},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-foreground",children:"Jobs"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Manage all car wash jobs. Open a job to update status and send WhatsApp messages to the customer."})]}),e.jsx(j,{to:"/admin/jobs/new",className:"min-h-[44px] flex items-center",children:e.jsxs(l,{className:"w-full sm:w-auto gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"New Job"]})})]}),e.jsx(x,{children:e.jsx(u,{className:"p-6",children:e.jsxs("form",{onSubmit:w,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search by token, customer name, phone, or car number...",value:E,onChange:s=>f(s.target.value),onKeyDown:s=>s.key==="Enter"&&w(s),className:"pl-9"})]}),e.jsx(l,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(T,{value:i,onValueChange:s=>{p(s),c(1)},children:[e.jsx(J,{className:"w-[180px]",children:e.jsx(z,{placeholder:"Status"})}),e.jsx(W,{children:Z.map(s=>e.jsx(B,{value:s.value,children:s.label},s.value))})]}),(n||i!=="ALL")&&e.jsx(l,{type:"button",variant:"ghost",size:"sm",onClick:()=>{g(""),f(""),p("ALL"),c(1)},children:"Clear"})]})]})})}),e.jsxs("div",{className:"grid gap-4",children:[h.map(s=>{const a=O(s.status);return e.jsx(x,{className:"transition-shadow duration-150",children:e.jsx(u,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Token: ",s.tokenNumber]}),e.jsx(_,{className:K[s.status]||"",children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{children:s.carId?.carNumber}),s.carId?.brand&&s.carId?.model&&e.jsxs("span",{children:["• ",s.carId.brand," ",s.carId.model]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",s.customerId?.name," • ",s.customerId?.phone]}),s.estimatedDelivery&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsxs("span",{children:["ETA: ",D(new Date(s.estimatedDelivery),"PPp")]})]}),s.services&&s.services.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Services: ",s.services.map(d=>d.serviceId?.name||"N/A").join(", ")]})]}),e.jsxs("div",{className:"sm:text-right space-y-2 flex-shrink-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-semibold text-slate-800",children:H(Number(s.totalPrice),A)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:D(new Date(s.createdAt),"MMM d, yyyy")}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[a&&s.status!=="DELIVERED"&&s.status!=="CANCELLED"&&e.jsxs(l,{size:"sm",onClick:()=>F(s._id,a),children:["Mark as ",a.replace("_"," ")]}),e.jsx(j,{to:`/admin/jobs/${s._id}`,className:"min-h-[40px] flex items-center",children:e.jsxs(l,{size:"sm",variant:"outline",className:"w-full sm:w-auto gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),"View details"]})})]})]})]})})},s._id)}),h.length===0&&!b&&e.jsx(x,{children:e.jsxs(u,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:n||i!=="ALL"?"No jobs match your search or filter.":"No jobs found"}),n||i!=="ALL"?e.jsx(l,{className:"mt-4",variant:"outline",onClick:()=>{g(""),f(""),p("ALL"),c(1)},children:"Clear filters"}):e.jsx(j,{to:"/admin/jobs/new",children:e.jsxs(l,{className:"mt-4",children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Create First Job"]})})]})})]}),o.totalPages>1&&e.jsx(x,{children:e.jsx(u,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",h.length===0?0:(r-1)*v+1,"–",(r-1)*v+h.length," of ",o.total," jobs"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>y(r-1),disabled:r<=1,children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",r," of ",o.totalPages]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>y(r+1),disabled:r>=o.totalPages,children:["Next",e.jsx(P,{className:"h-4 w-4 ml-1"})]})]})]})})})]})}export{pe as default};
