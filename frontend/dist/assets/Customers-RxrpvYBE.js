import{a as j,u as i,j as e}from"./index-YmJ5rGxO.js";import{r as l}from"./vendor-redux-FsoCpCcR.js";import{C as f,d as N,a as J,b as Z}from"./card-C1Os2Jzs.js";import{B as r}from"./button-BZ__ZVvs.js";import{I as o}from"./input-lKSy0GOu.js";import{L as c}from"./label-C0QsUGTD.js";import{D as q,e as Q,a as W,b as L,c as O,d as T}from"./dialog-DioR_SNv.js";import{p as I}from"./formUtils-CjVQbo5F.js";import{P as V}from"./plus-BOAFu-8E.js";import{S as U}from"./search-yXlgkkGt.js";import{M as X}from"./message-circle-DvhV2ynm.js";import{P as Y}from"./pen-square-DESXZr50.js";import{T as ee}from"./trash-2-CyIO3SZl.js";import{C as se,a as ae}from"./chevron-right-Uxjaubls.js";import"./vendor-react-BGYP6dvN.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";import"./createLucideIcon-BRnZLpr8.js";const w=12;function te(m){return!m||typeof m!="string"?"":m.replace(/\D/g,"")}function Ce(){const[m,S]=l.useState([]),[D,F]=l.useState(!0),[h,v]=l.useState(""),[P,y]=l.useState(""),[d,p]=l.useState(1),[u,_]=l.useState({total:0,totalPages:0}),[$,C]=l.useState(!1),[K,x]=l.useState(!1),[A,b]=l.useState(null),[a,n]=l.useState({name:"",phone:"",whatsappNumber:"",email:"",address:"",notes:""});l.useEffect(()=>{g()},[h,d]);const g=async()=>{F(!0);try{const s=new URLSearchParams;s.set("page",String(d)),s.set("limit",String(w)),h.trim()&&s.set("search",h.trim());const t=await j.get(`/admin/customers?${s.toString()}`);t.data.success?(S(t.data.customers||[]),t.data.pagination&&_({total:t.data.pagination.total,totalPages:t.data.pagination.totalPages})):i.error("Failed to load customers")}catch(s){console.error("Failed to load customers:",s),i.error(s.response?.data?.message||"Failed to load customers")}finally{F(!1)}},E=s=>{s?.preventDefault(),v(P),p(1)},k=s=>{s<1||s>u.totalPages||p(s)},M=s=>{const t=te(s.whatsappNumber||s.phone);if(!t){i.error("No WhatsApp number for this customer");return}window.open(`https://wa.me/${t}`,"_blank","noopener,noreferrer")},R=async s=>{s.preventDefault();try{(await j.post("/admin/customers",a)).data.success?(i.success("Customer created successfully!"),C(!1),z(),g()):i.error("Failed to create customer")}catch(t){console.error("Create customer error:",t),i.error(t.response?.data?.message||"Failed to create customer")}},B=async s=>{if(s.preventDefault(),!!A)try{(await j.put(`/admin/customers/${A._id}`,a)).data.success?(i.success("Customer updated successfully!"),x(!1),b(null),z(),g()):i.error("Failed to update customer")}catch(t){console.error("Update customer error:",t),i.error(t.response?.data?.message||"Failed to update customer")}},H=s=>{b(s),n({name:s.name,phone:s.phone,whatsappNumber:s.whatsappNumber||"",email:s.email||"",address:s.address||"",notes:s.notes||""}),x(!0)},G=async s=>{if(confirm("Are you sure you want to delete this customer?"))try{(await j.delete(`/admin/customers/${s}`)).data.success?(i.success("Customer deleted successfully!"),g()):i.error("Failed to delete customer")}catch(t){console.error("Delete customer error:",t),i.error(t.response?.data?.message||"Failed to delete customer")}},z=()=>{n({name:"",phone:"",whatsappNumber:"",email:"",address:"",notes:""})};return D?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your customers"})]}),e.jsxs(q,{open:$,onOpenChange:C,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(r,{children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Add Customer"]})}),e.jsxs(W,{children:[e.jsxs(L,{children:[e.jsx(O,{children:"Create New Customer"}),e.jsx(T,{children:"Add a new customer to your system"})]}),e.jsxs("form",{onSubmit:R,onKeyDown:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Name *"}),e.jsx(o,{id:"name",value:a.name,onChange:s=>n({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",children:"Phone *"}),e.jsx(o,{id:"phone",value:a.phone,onChange:s=>n({...a,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"whatsappNumber",children:"WhatsApp Number *"}),e.jsx(o,{id:"whatsappNumber",value:a.whatsappNumber,onChange:s=>n({...a,whatsappNumber:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(r,{type:"submit",children:"Create Customer"})]})]})]})]}),e.jsx(q,{open:K,onOpenChange:x,children:e.jsxs(W,{children:[e.jsxs(L,{children:[e.jsx(O,{children:"Edit Customer"}),e.jsx(T,{children:"Update customer information"})]}),e.jsxs("form",{onSubmit:B,onKeyDown:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-name",children:"Name *"}),e.jsx(o,{id:"edit-name",value:a.name,onChange:s=>n({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(o,{id:"edit-phone",value:a.phone,onChange:s=>n({...a,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-whatsappNumber",children:"WhatsApp Number *"}),e.jsx(o,{id:"edit-whatsappNumber",value:a.whatsappNumber,onChange:s=>n({...a,whatsappNumber:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-email",children:"Email"}),e.jsx(o,{id:"edit-email",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-address",children:"Address"}),e.jsx(o,{id:"edit-address",value:a.address,onChange:s=>n({...a,address:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(o,{id:"edit-notes",value:a.notes,onChange:s=>n({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>{x(!1),b(null)},children:"Cancel"}),e.jsx(r,{type:"submit",children:"Update Customer"})]})]})]})})]}),e.jsx(f,{children:e.jsx(N,{className:"p-6",children:e.jsx("form",{onSubmit:E,className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search by name, phone, WhatsApp, or email...",value:P,onChange:s=>y(s.target.value),onKeyDown:s=>s.key==="Enter"&&E(s),className:"pl-9"})]}),e.jsx(r,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(U,{className:"h-4 w-4"})}),h&&e.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>{v(""),y(""),p(1)},children:"Clear"})]})})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[m.length===0&&!D&&e.jsx(f,{className:"md:col-span-2 lg:col-span-3",children:e.jsxs(N,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:h?"No customers match your search.":"No customers yet. Add your first customer to get started."}),h&&e.jsx(r,{className:"mt-4",variant:"outline",onClick:()=>{v(""),y(""),p(1)},children:"Clear search"})]})}),m.map(s=>e.jsxs(f,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Z,{children:s.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>M(s),title:"WhatsApp",className:"text-[#25D366] hover:text-[#25D366] hover:bg-[#25D366]/10",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>H(s),title:"Edit",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>G(s._id),title:"Delete",className:"text-destructive hover:text-destructive",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:s.phone}),e.jsx("p",{className:"text-muted-foreground",children:s.whatsappNumber}),s.email&&e.jsx("p",{className:"text-muted-foreground",children:s.email}),e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cars: "}),e.jsx("span",{className:"font-medium",children:s.stats?.cars||0}),e.jsx("span",{className:"text-muted-foreground ml-4",children:"Jobs: "}),e.jsx("span",{className:"font-medium",children:s.stats?.jobs||0})]})]})})]},s._id))]}),u.totalPages>1&&e.jsx(f,{children:e.jsx(N,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",m.length===0?0:(d-1)*w+1,"â€“",(d-1)*w+m.length," of ",u.total," customers"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>k(d-1),disabled:d<=1,children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",d," of ",u.totalPages]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>k(d+1),disabled:d>=u.totalPages,children:["Next",e.jsx(ae,{className:"h-4 w-4 ml-1"})]})]})]})})})]})}export{Ce as default};
