import{a as i,u as t,j as e}from"./index-YmJ5rGxO.js";import{r as c}from"./vendor-redux-FsoCpCcR.js";import{u as X,L as _}from"./vendor-react-BGYP6dvN.js";import{C as x,a as k,b as L,d as D}from"./card-C1Os2Jzs.js";import{B as l}from"./button-BZ__ZVvs.js";import{I as m}from"./input-lKSy0GOu.js";import{L as d}from"./label-C0QsUGTD.js";import{S as P,a as q,b as A,c as E,d as T}from"./select-CkWAxkRE.js";import{p as Y}from"./formUtils-CjVQbo5F.js";import{f as Z}from"./currencyUtils-CJd_f-r_.js";import{A as ee}from"./arrow-left-BKxa5Psn.js";import{P as J}from"./plus-BOAFu-8E.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";import"./createLucideIcon-BRnZLpr8.js";function je(){const R=X(),[f,g]=c.useState([]),[C,v]=c.useState([]),[$,B]=c.useState([]),[V,z]=c.useState("USD"),[H,K]=c.useState(!0),[N,b]=c.useState(!1),[a,u]=c.useState({customerId:"",carId:"",serviceIds:[],notes:""}),[n,p]=c.useState({name:"",phone:"",whatsappNumber:"",email:""}),[o,h]=c.useState({carNumber:"",brand:"",model:"",color:""}),[y,w]=c.useState(!1),[I,S]=c.useState(!1);c.useEffect(()=>{M()},[]),c.useEffect(()=>{a.customerId&&U(a.customerId)},[a.customerId]);const M=async()=>{try{const[s,r,j]=await Promise.all([i.get("/admin/customers"),i.get("/admin/services"),i.get("/admin/settings").catch(()=>({data:{}}))]);s.data.success&&g(s.data.customers||[]),r.data.success&&B((r.data.services||[]).filter(Q=>Q.isActive)),j?.data?.success&&j.data.settings?.currency&&z(j.data.settings.currency)}catch(s){console.error("Failed to load data:",s),t.error(s.response?.data?.message||"Failed to load data")}finally{K(!1)}},U=async s=>{try{const r=await i.get(`/admin/cars?customerId=${s}`);r.data.success&&v(r.data.cars||[])}catch(r){console.error("Failed to load cars:",r),t.error(r.response?.data?.message||"Failed to load cars")}},W=async()=>{try{const s=await i.post("/admin/customers",n);s.data.success?(g([...f,s.data.customer]),u({...a,customerId:s.data.customer._id}),p({name:"",phone:"",whatsappNumber:"",email:""}),w(!1),t.success("Customer created successfully!")):t.error("Failed to create customer")}catch(s){console.error("Create customer error:",s),t.error(s.response?.data?.message||"Failed to create customer")}},G=async()=>{if(!a.customerId){t.error("Please select a customer first");return}try{const s=await i.post("/admin/cars",{...o,customerId:a.customerId});s.data.success?(v([...C,s.data.car]),u({...a,carId:s.data.car._id}),h({carNumber:"",brand:"",model:"",color:""}),S(!1),t.success("Car created successfully!")):t.error("Failed to create car")}catch(s){console.error("Create car error:",s),t.error(s.response?.data?.message||"Failed to create car")}},F=s=>{a.serviceIds.includes(s)?u({...a,serviceIds:a.serviceIds.filter(r=>r!==s)}):u({...a,serviceIds:[...a.serviceIds,s]})},O=async s=>{if(s.preventDefault(),!a.customerId||!a.carId||a.serviceIds.length===0){t.error("Please fill all required fields");return}b(!0);try{(await i.post("/admin/jobs",a)).data.success?(t.success("Job created successfully!"),R("/admin/jobs")):t.error("Failed to create job")}catch(r){console.error("Create job error:",r),t.error(r.response?.data?.message||"Failed to create job")}finally{b(!1)}};return H?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{to:"/admin/jobs",children:e.jsx(l,{variant:"ghost",size:"icon",children:e.jsx(ee,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create New Job"}),e.jsx("p",{className:"text-muted-foreground",children:"Add a new car wash job"})]})]}),e.jsxs("form",{onSubmit:O,onKeyDown:Y,className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(k,{children:e.jsx(L,{children:"Customer & Car"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Customer *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{value:a.customerId,onValueChange:s=>u({...a,customerId:s,carId:""}),children:[e.jsx(q,{className:"flex-1",children:e.jsx(A,{placeholder:"Select customer"})}),e.jsx(E,{children:f.map(s=>e.jsxs(T,{value:s._id,children:[s.name," - ",s.phone]},s._id))})]}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>w(!y),children:e.jsx(J,{className:"h-4 w-4"})})]}),y&&e.jsxs(x,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name *"}),e.jsx(m,{value:n.name,onChange:s=>p({...n,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Phone *"}),e.jsx(m,{value:n.phone,onChange:s=>p({...n,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"WhatsApp Number *"}),e.jsx(m,{value:n.whatsappNumber,onChange:s=>p({...n,whatsappNumber:s.target.value}),required:!0})]}),e.jsx(l,{type:"button",onClick:W,children:"Create Customer"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Car *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{value:a.carId,onValueChange:s=>u({...a,carId:s}),disabled:!a.customerId,children:[e.jsx(q,{className:"flex-1",children:e.jsx(A,{placeholder:"Select car"})}),e.jsx(E,{children:C.map(s=>e.jsxs(T,{value:s._id,children:[s.carNumber," ",s.brand&&s.model&&`- ${s.brand} ${s.model}`]},s._id))})]}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>S(!I),disabled:!a.customerId,children:e.jsx(J,{className:"h-4 w-4"})})]}),I&&e.jsxs(x,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Car Number *"}),e.jsx(m,{value:o.carNumber,onChange:s=>h({...o,carNumber:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Brand"}),e.jsx(m,{value:o.brand,onChange:s=>h({...o,brand:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Model"}),e.jsx(m,{value:o.model,onChange:s=>h({...o,model:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Color"}),e.jsx(m,{value:o.color,onChange:s=>h({...o,color:s.target.value})})]})]}),e.jsx(l,{type:"button",onClick:G,children:"Create Car"})]})]})]})]}),e.jsxs(x,{children:[e.jsx(k,{children:e.jsx(L,{children:"Services *"})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-2",children:$.map(s=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg cursor-pointer ${a.serviceIds.includes(s._id)?"border-primary bg-primary/5":""}`,onClick:()=>F(s._id),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Z(s.price,V)," â€¢ ",s.minTime,"-",s.maxTime," min"]})]}),e.jsx("input",{type:"checkbox",checked:a.serviceIds.includes(s._id),onChange:()=>F(s._id),className:"h-4 w-4"})]},s._id))})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{to:"/admin/jobs",children:e.jsx(l,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(l,{type:"submit",disabled:N,children:N?"Creating...":"Create Job"})]})]})]})}export{je as default};
