import{a as p,u as c,j as e}from"./index-YmJ5rGxO.js";import{r as n}from"./vendor-redux-FsoCpCcR.js";import{C as v,a as B,d as b,b as re,c as ne}from"./card-C1Os2Jzs.js";import{B as d}from"./button-BZ__ZVvs.js";import{I as u}from"./input-lKSy0GOu.js";import{L as l}from"./label-C0QsUGTD.js";import{T as O}from"./textarea-CojeXS5Z.js";import{D as $,a as U,b as V,c as _,d as K}from"./dialog-DioR_SNv.js";import{D as le,a as ce,M as de,b as oe,c as F}from"./dropdown-menu-Ydebwvw5.js";import{S as ue,a as me,b as he,c as pe,d as P}from"./select-CkWAxkRE.js";import{B as R}from"./badge-dOlDYKGI.js";import{p as H}from"./formUtils-CjVQbo5F.js";import{f as xe}from"./currencyUtils-CJd_f-r_.js";import{P as fe}from"./plus-BOAFu-8E.js";import{S as G}from"./search-yXlgkkGt.js";import{T as je}from"./trash-2-CyIO3SZl.js";import{C as ge,a as ve}from"./chevron-right-Uxjaubls.js";import"./vendor-react-BGYP6dvN.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";import"./createLucideIcon-BRnZLpr8.js";const k=12;function Ue(){const[y,Z]=n.useState([]),[T,L]=n.useState(!0),[h,S]=n.useState(""),[E,w]=n.useState(""),[m,D]=n.useState("ALL"),[o,x]=n.useState(1),[f,J]=n.useState({total:0,totalPages:0}),[Q,W]=n.useState("USD"),[X,N]=n.useState(!1),[Y,C]=n.useState(!1),[I,q]=n.useState(null),[a,i]=n.useState({name:"",description:"",validityDays:30,price:0,features:[""],isActive:!0,isFreeTrial:!1});n.useEffect(()=>{j()},[h,m,o]),n.useEffect(()=>{p.get("/super-admin/settings").then(s=>{s.data?.success&&s.data.settings?.defaultCurrency&&W(s.data.settings.defaultCurrency)}).catch(()=>{})},[]);const j=async()=>{L(!0);try{const s=new URLSearchParams;s.set("page",String(o)),s.set("limit",String(k)),h.trim()&&s.set("search",h.trim()),m!=="ALL"&&s.set("isActive",m==="true");const t=await p.get(`/super-admin/subscription-plans?${s.toString()}`);t.data.success&&(Z(t.data.plans||[]),t.data.pagination&&J({total:t.data.pagination.total,totalPages:t.data.pagination.totalPages}))}catch(s){c.error(s.response?.data?.message||"Failed to load plans")}finally{L(!1)}},z=s=>{s?.preventDefault(),S(E),x(1)},M=s=>{s<1||s>f.totalPages||x(s)},A=()=>{i({name:"",description:"",validityDays:30,price:0,features:[""],isActive:!0,isFreeTrial:!1}),q(null)},ee=async s=>{s.preventDefault();const t=a.features.filter(Boolean);if(!a.name||a.validityDays<1){c.error("Name and validity (≥1 day) required");return}try{(await p.post("/super-admin/subscription-plans",{...a,features:t})).data.success?(c.success("Plan created"),N(!1),A(),j()):c.error("Failed to create plan")}catch(r){c.error(r.response?.data?.message||"Failed to create plan")}},se=async s=>{if(s.preventDefault(),!I)return;const t=a.features.filter(Boolean);try{(await p.put(`/super-admin/subscription-plans/${I._id}`,{...a,features:t})).data.success?(c.success("Plan updated"),C(!1),A(),j()):c.error("Failed to update plan")}catch(r){c.error(r.response?.data?.message||"Failed to update plan")}},ae=async(s,t)=>{try{(await p.patch(`/super-admin/subscription-plans/${s._id}/status`,{isActive:t})).data.success&&(c.success(t?"Plan activated":"Plan deactivated"),j())}catch(r){c.error(r.response?.data?.message||"Failed to update status")}},te=async s=>{if(window.confirm(`Delete plan "${s.name}"? This cannot be undone.`))try{const t=await p.delete(`/super-admin/subscription-plans/${s._id}`);t.data.success?(c.success("Plan deleted"),j()):c.error(t.data.message||"Failed to delete plan")}catch(t){c.error(t.response?.data?.message||"Failed to delete plan")}},ie=s=>{q(s),i({name:s.name,description:s.description||"",validityDays:s.validityDays||30,price:s.price??0,features:s.features?.length?s.features:[""],isActive:s.isActive!==!1,isFreeTrial:s.isFreeTrial===!0}),C(!0)};return T?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(v,{className:"animate-pulse",children:e.jsx(B,{className:"h-24 bg-muted rounded-lg"})},s))}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-800",children:"Subscription Plans"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-0.5",children:"Manual subscription plans (no online payments). Admin approval required for upgrades."})]}),e.jsxs(d,{onClick:()=>{A(),N(!0)},className:"min-h-[44px] gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Add Plan"]})]}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("form",{onSubmit:z,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(u,{placeholder:"Search by name or description...",value:E,onChange:s=>w(s.target.value),onKeyDown:s=>s.key==="Enter"&&z(s),className:"pl-9"})]}),e.jsx(d,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(G,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(ue,{value:m,onValueChange:s=>{D(s),x(1)},children:[e.jsx(me,{className:"w-[160px]",children:e.jsx(he,{placeholder:"Status"})}),e.jsxs(pe,{children:[e.jsx(P,{value:"ALL",children:"All plans"}),e.jsx(P,{value:"true",children:"Active"}),e.jsx(P,{value:"false",children:"Inactive"})]})]}),(h||m!=="ALL")&&e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>{S(""),w(""),D("ALL"),x(1)},children:"Clear"})]})]})})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:y.map(s=>e.jsxs(v,{className:"transition-shadow duration-150",children:[e.jsx(B,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-lg text-slate-800",children:s.name}),e.jsxs(ne,{children:[s.validityDays," days validity · ",xe(s.price??0,Q)]})]}),e.jsxs(le,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs(oe,{align:"end",children:[e.jsx(F,{onClick:()=>ie(s),children:"Edit"}),e.jsx(F,{onClick:()=>ae(s,!s.isActive),children:s.isActive?"Deactivate":"Activate"}),!s.isActive&&e.jsxs(F,{onClick:()=>te(s),className:"text-destructive focus:text-destructive",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})}),e.jsxs(b,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(R,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"}),s.isFreeTrial&&e.jsx(R,{variant:"outline",children:"Free trial"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.features?.length>0&&e.jsxs("ul",{className:"text-sm list-disc list-inside space-y-1",children:[s.features.slice(0,4).map((t,r)=>e.jsx("li",{children:t},r)),s.features.length>4&&e.jsxs("li",{className:"text-muted-foreground",children:["+",s.features.length-4," more"]})]})]})]},s._id))}),y.length===0&&!T&&e.jsx(v,{children:e.jsxs(b,{className:"p-12 text-center text-muted-foreground",children:[h||m!=="ALL"?"No plans match your search or filter.":"No subscription plans yet. Add a plan to let shops request upgrades.",(h||m!=="ALL")&&e.jsx(d,{className:"mt-4",variant:"outline",onClick:()=>{S(""),w(""),D("ALL"),x(1)},children:"Clear"})]})}),f.totalPages>1&&e.jsx(v,{children:e.jsx(b,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",y.length===0?0:(o-1)*k+1,"–",(o-1)*k+y.length," of ",f.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>M(o-1),disabled:o<=1,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",o," of ",f.totalPages]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>M(o+1),disabled:o>=f.totalPages,children:["Next",e.jsx(ve,{className:"h-4 w-4 ml-1"})]})]})]})})}),e.jsx($,{open:X,onOpenChange:N,children:e.jsxs(U,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(_,{children:"Add Subscription Plan"}),e.jsx(K,{children:"Plans are used for manual upgrades. No payment processing."})]}),e.jsxs("form",{onSubmit:ee,onKeyDown:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Plan name *"}),e.jsx(u,{value:a.name,onChange:s=>i({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Description"}),e.jsx(O,{value:a.description,onChange:s=>i({...a,description:s.target.value}),rows:2})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Validity (days) *"}),e.jsx(u,{type:"number",min:1,value:a.validityDays,onChange:s=>i({...a,validityDays:parseInt(s.target.value)||1}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Price"}),e.jsx(u,{type:"number",min:0,step:.01,value:a.price,onChange:s=>i({...a,price:parseFloat(s.target.value)||0}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Features (one per line)"}),a.features.map((s,t)=>e.jsx(u,{className:"mb-2",value:s,onChange:r=>{const g=[...a.features];g[t]=r.target.value,i({...a,features:g})},placeholder:`Feature ${t+1}`},t)),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>i({...a,features:[...a.features,""]}),children:"+ Add feature"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:a.isActive,onChange:s=>i({...a,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(l,{htmlFor:"isActive",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isFreeTrial",checked:a.isFreeTrial,onChange:s=>i({...a,isFreeTrial:s.target.checked}),className:"h-4 w-4"}),e.jsx(l,{htmlFor:"isFreeTrial",children:"Free trial (one-time per shop; disabled for life after upgrade)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(d,{type:"submit",children:"Create Plan"})]})]})]})}),e.jsx($,{open:Y,onOpenChange:C,children:e.jsxs(U,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(_,{children:"Edit Plan"}),e.jsx(K,{children:"Update plan details."})]}),e.jsxs("form",{onSubmit:se,onKeyDown:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Plan name *"}),e.jsx(u,{value:a.name,onChange:s=>i({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Description"}),e.jsx(O,{value:a.description,onChange:s=>i({...a,description:s.target.value}),rows:2})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Validity (days) *"}),e.jsx(u,{type:"number",min:1,value:a.validityDays,onChange:s=>i({...a,validityDays:parseInt(s.target.value)||1}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Price"}),e.jsx(u,{type:"number",min:0,step:.01,value:a.price,onChange:s=>i({...a,price:parseFloat(s.target.value)||0}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Features"}),a.features.map((s,t)=>e.jsx(u,{className:"mb-2",value:s,onChange:r=>{const g=[...a.features];g[t]=r.target.value,i({...a,features:g})}},t)),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>i({...a,features:[...a.features,""]}),children:"+ Add feature"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editActive",checked:a.isActive,onChange:s=>i({...a,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(l,{htmlFor:"editActive",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editFreeTrial",checked:a.isFreeTrial,onChange:s=>i({...a,isFreeTrial:s.target.checked}),className:"h-4 w-4"}),e.jsx(l,{htmlFor:"editFreeTrial",children:"Free trial (one-time per shop; disabled for life after upgrade)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(d,{type:"submit",children:"Update Plan"})]})]})]})})]})}export{Ue as default};
