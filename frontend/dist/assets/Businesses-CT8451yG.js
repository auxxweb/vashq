import{a as x,u as l,j as e}from"./index-YmJ5rGxO.js";import{r as d}from"./vendor-redux-FsoCpCcR.js";import{C as f,a as U,d as C,b as de,c as oe}from"./card-C1Os2Jzs.js";import{B as o}from"./button-BZ__ZVvs.js";import{I as i}from"./input-lKSy0GOu.js";import{L as n}from"./label-C0QsUGTD.js";import{S as y,a as b,b as S,c as E,d as c}from"./select-CkWAxkRE.js";import{D as O,a as V,b as $,c as W,d as G}from"./dialog-DioR_SNv.js";import{D as ce,a as ue,M as me,b as he,c as k}from"./dropdown-menu-Ydebwvw5.js";import{B as pe}from"./badge-dOlDYKGI.js";import{p as R}from"./formUtils-CjVQbo5F.js";import{P as _}from"./plus-BOAFu-8E.js";import{S as z}from"./search-yXlgkkGt.js";import{C as xe,a as ge}from"./chevron-right-Uxjaubls.js";import"./vendor-react-BGYP6dvN.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";import"./createLucideIcon-BRnZLpr8.js";const D=12;function Be(){const[P,K]=d.useState([]),[I,A]=d.useState(!0),[g,L]=d.useState(""),[B,H]=d.useState(""),[p,F]=d.useState("ALL"),[u,j]=d.useState(1),[h,Z]=d.useState({total:0,totalPages:0}),[Q,N]=d.useState(!1),[X,w]=d.useState(!1),[Y,J]=d.useState(null),[a,t]=d.useState({businessName:"",ownerName:"",phone:"",email:"",whatsappNumber:"",address:"",location:"",workingHoursStart:"09:00",workingHoursEnd:"18:00",carHandlingCapacity:"SINGLE",maxConcurrentJobs:1,defaultCurrency:"USD",defaultLanguage:"en",adminEmail:"",adminPassword:""});d.useEffect(()=>{v()},[g,p,u]);const v=async()=>{A(!0);try{const s=new URLSearchParams;s.set("page",String(u)),s.set("limit",String(D)),g.trim()&&s.set("search",g.trim()),p!=="ALL"&&s.set("status",p);const r=await x.get(`/super-admin/businesses?${s.toString()}`);r.data.success?(K(r.data.businesses||[]),r.data.pagination&&Z({total:r.data.pagination.total,totalPages:r.data.pagination.totalPages})):l.error("Failed to load businesses")}catch(s){console.error("Failed to load businesses:",s),l.error(s.response?.data?.message||"Failed to load businesses")}finally{A(!1)}},q=s=>{s?.preventDefault(),L(B),j(1)},T=s=>{s<1||s>h.totalPages||j(s)},ee=async s=>{s.preventDefault();try{const r={...a};r.adminEmail||delete r.adminEmail,r.adminPassword||delete r.adminPassword;const m=await x.post("/super-admin/businesses",r);if(m.data.success){const ie="Business created successfully!",le=m.data.adminUser?.password?`Admin Email: ${m.data.adminUser.email}
Password: ${m.data.adminUser.password}`:"Business created";l.success(ie,{description:le,duration:1e4}),N(!1),M(),v()}else l.error("Failed to create business")}catch(r){console.error("Create business error:",r),l.error(r.response?.data?.message||"Failed to create business")}},se=async s=>{s.preventDefault();try{(await x.put(`/super-admin/businesses/${Y._id}`,a)).data.success?(l.success("Business updated successfully!"),w(!1),M(),v()):l.error("Failed to update business")}catch(r){console.error("Update business error:",r),l.error(r.response?.data?.message||"Failed to update business")}},ae=async(s,r)=>{try{(await x.post(`/super-admin/businesses/${s}/suspend`,{status:r})).data.success?(l.success(`Business ${r==="ACTIVE"?"activated":"suspended"} successfully!`),v()):l.error("Failed to update business status")}catch(m){console.error("Suspend business error:",m),l.error(m.response?.data?.message||"Failed to update business status")}},re=async s=>{if(confirm("Are you sure you want to delete this business? This will remove the business and its admin user. This action cannot be undone."))try{(await x.delete(`/super-admin/businesses/${s}`)).data.success?(l.success("Business deleted successfully!"),v()):l.error("Failed to delete business")}catch(r){console.error("Delete business error:",r),l.error(r.response?.data?.message||"Failed to delete business")}},te=async s=>{try{const r=await x.post(`/super-admin/businesses/${s}/reset-password`,{});r.data.success?l.success("Password reset successfully!",{description:r.data.newPassword?`New password: ${r.data.newPassword}`:"Password updated"}):l.error("Failed to reset password")}catch(r){console.error("Reset password error:",r),l.error(r.response?.data?.message||"Failed to reset password")}},M=()=>{t({businessName:"",ownerName:"",phone:"",email:"",whatsappNumber:"",address:"",location:"",workingHoursStart:"09:00",workingHoursEnd:"18:00",carHandlingCapacity:"SINGLE",maxConcurrentJobs:1,defaultCurrency:"USD",defaultLanguage:"en",adminEmail:"",adminPassword:""}),J(null)},ne=s=>{J(s),t({businessName:s.businessName,ownerName:s.ownerName,phone:s.phone,email:s.email,whatsappNumber:s.whatsappNumber,address:s.address,location:s.location||"",workingHoursStart:s.workingHoursStart,workingHoursEnd:s.workingHoursEnd,carHandlingCapacity:s.carHandlingCapacity,maxConcurrentJobs:s.maxConcurrentJobs,defaultCurrency:s.defaultCurrency,defaultLanguage:s.defaultLanguage}),w(!0)};return I?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsx(f,{className:"animate-pulse",children:e.jsx(U,{className:"h-32 bg-muted rounded-lg"})},s))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Car Washes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage all car wash businesses"})]}),e.jsxs(o,{onClick:()=>N(!0),className:"gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Add Business"]})]}),e.jsx(O,{open:Q,onOpenChange:N,children:e.jsxs(V,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(W,{children:"Onboard New Car Wash Business"}),e.jsx(G,{children:"Complete the onboarding workflow to add a new car wash business"})]}),e.jsxs("form",{onSubmit:ee,onKeyDown:R,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Business Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"businessName",children:"Business Name *"}),e.jsx(i,{id:"businessName",value:a.businessName,onChange:s=>t({...a,businessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"ownerName",children:"Owner Name *"}),e.jsx(i,{id:"ownerName",value:a.ownerName,onChange:s=>t({...a,ownerName:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Business Email *"}),e.jsx(i,{id:"email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(i,{id:"phone",value:a.phone,onChange:s=>t({...a,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"whatsappNumber",children:"WhatsApp Number *"}),e.jsx(i,{id:"whatsappNumber",value:a.whatsappNumber,onChange:s=>t({...a,whatsappNumber:s.target.value}),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address",children:"Address *"}),e.jsx(i,{id:"address",value:a.address,onChange:s=>t({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"location",children:"Location (Optional)"}),e.jsx(i,{id:"location",value:a.location,onChange:s=>t({...a,location:s.target.value}),placeholder:"City, State, Country"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"workingHoursStart",children:"Working Hours Start *"}),e.jsx(i,{id:"workingHoursStart",type:"time",value:a.workingHoursStart,onChange:s=>t({...a,workingHoursStart:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"workingHoursEnd",children:"Working Hours End *"}),e.jsx(i,{id:"workingHoursEnd",type:"time",value:a.workingHoursEnd,onChange:s=>t({...a,workingHoursEnd:s.target.value}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Operational Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"carHandlingCapacity",children:"Car Handling Capacity *"}),e.jsxs(y,{value:a.carHandlingCapacity,onValueChange:s=>t({...a,carHandlingCapacity:s,maxConcurrentJobs:s==="SINGLE"?1:a.maxConcurrentJobs}),children:[e.jsx(b,{children:e.jsx(S,{})}),e.jsxs(E,{children:[e.jsx(c,{value:"SINGLE",children:"Single Car"}),e.jsx(c,{value:"MULTIPLE",children:"Multiple Cars"})]})]})]}),a.carHandlingCapacity==="MULTIPLE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"maxConcurrentJobs",children:"Max Concurrent Jobs *"}),e.jsx(i,{id:"maxConcurrentJobs",type:"number",min:"1",value:a.maxConcurrentJobs,onChange:s=>t({...a,maxConcurrentJobs:parseInt(s.target.value)||1}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Admin User Credentials"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Leave blank to use business email and auto-generate password"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"adminEmail",children:"Admin Email (Optional)"}),e.jsx(i,{id:"adminEmail",type:"email",value:a.adminEmail,onChange:s=>t({...a,adminEmail:s.target.value}),placeholder:"Leave blank to use business email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"adminPassword",children:"Admin Password (Optional)"}),e.jsx(i,{id:"adminPassword",type:"password",value:a.adminPassword,onChange:s=>t({...a,adminPassword:s.target.value}),placeholder:"Leave blank to auto-generate",minLength:6})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(o,{type:"submit",children:"Onboard Business"})]})]})]})}),e.jsx(f,{children:e.jsx(C,{className:"p-6",children:e.jsxs("form",{onSubmit:q,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search by name, owner, email...",value:B,onChange:s=>H(s.target.value),onKeyDown:s=>s.key==="Enter"&&q(s),className:"pl-9"})]}),e.jsx(o,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(y,{value:p,onValueChange:s=>{F(s),j(1)},children:[e.jsx(b,{className:"w-[160px]",children:e.jsx(S,{placeholder:"Status"})}),e.jsxs(E,{children:[e.jsx(c,{value:"ALL",children:"All"}),e.jsx(c,{value:"ACTIVE",children:"Active"}),e.jsx(c,{value:"SUSPENDED",children:"Suspended"}),e.jsx(c,{value:"INACTIVE",children:"Inactive"})]})]}),(g||p!=="ALL")&&e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>{L(""),H(""),F("ALL"),j(1)},children:"Clear"})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[P.map(s=>e.jsxs(f,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-lg",children:s.businessName}),e.jsx(oe,{children:s.ownerName})]}),e.jsxs(ce,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(he,{align:"end",children:[e.jsx(k,{onClick:r=>{r.preventDefault(),ne(s)},children:"Edit"}),e.jsx(k,{onClick:r=>{r.preventDefault(),te(s._id)},children:"Reset Password"}),e.jsx(k,{onClick:r=>{r.preventDefault(),ae(s._id,s.status==="ACTIVE"?"SUSPENDED":"ACTIVE")},children:s.status==="ACTIVE"?"Suspend":"Activate"}),e.jsx(k,{onClick:r=>{r.preventDefault(),re(s._id)},className:"text-destructive focus:text-destructive",children:"Delete"})]})]})]})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status"}),e.jsx(pe,{variant:s.status==="ACTIVE"?"default":"secondary",children:s.status})]}),s.plan?.planId&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan"}),e.jsx("span",{className:"font-medium",children:s.plan.planId.name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Jobs"}),e.jsx("span",{className:"font-medium",children:s.stats?.jobs||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Customers"}),e.jsx("span",{className:"font-medium",children:s.stats?.customers||0})]})]})})]},s._id)),P.length===0&&!I&&e.jsx(f,{className:"col-span-full",children:e.jsxs(C,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"No businesses found"}),g||p!=="ALL"?e.jsx(o,{variant:"outline",className:"mt-4",onClick:()=>{L(""),H(""),F("ALL"),j(1)},children:"Clear filters"}):e.jsxs(o,{className:"mt-4",onClick:()=>N(!0),children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Create First Business"]})]})})]}),h.totalPages>1&&e.jsx(f,{children:e.jsx(C,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min((u-1)*D+1,h.total),"â€“",Math.min(u*D,h.total)," of ",h.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>T(u-1),disabled:u<=1,children:[e.jsx(xe,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("span",{className:"text-sm",children:["Page ",u," of ",h.totalPages]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>T(u+1),disabled:u>=h.totalPages,children:["Next",e.jsx(ge,{className:"h-4 w-4"})]})]})]})})}),e.jsx(O,{open:X,onOpenChange:w,children:e.jsxs(V,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(W,{children:"Edit Business"}),e.jsx(G,{children:"Update all business information"})]}),e.jsxs("form",{onSubmit:se,onKeyDown:R,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-businessName",children:"Business Name *"}),e.jsx(i,{id:"edit-businessName",value:a.businessName,onChange:s=>t({...a,businessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-ownerName",children:"Owner Name *"}),e.jsx(i,{id:"edit-ownerName",value:a.ownerName,onChange:s=>t({...a,ownerName:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-email",children:"Business Email *"}),e.jsx(i,{id:"edit-email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(i,{id:"edit-phone",value:a.phone,onChange:s=>t({...a,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-whatsappNumber",children:"WhatsApp Number *"}),e.jsx(i,{id:"edit-whatsappNumber",value:a.whatsappNumber,onChange:s=>t({...a,whatsappNumber:s.target.value}),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-address",children:"Address *"}),e.jsx(i,{id:"edit-address",value:a.address,onChange:s=>t({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-location",children:"Location (Optional)"}),e.jsx(i,{id:"edit-location",value:a.location,onChange:s=>t({...a,location:s.target.value}),placeholder:"City, State, Country"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-workingHoursStart",children:"Working Hours Start *"}),e.jsx(i,{id:"edit-workingHoursStart",type:"time",value:a.workingHoursStart,onChange:s=>t({...a,workingHoursStart:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-workingHoursEnd",children:"Working Hours End *"}),e.jsx(i,{id:"edit-workingHoursEnd",type:"time",value:a.workingHoursEnd,onChange:s=>t({...a,workingHoursEnd:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-carHandlingCapacity",children:"Car Handling Capacity *"}),e.jsxs(y,{value:a.carHandlingCapacity,onValueChange:s=>t({...a,carHandlingCapacity:s,maxConcurrentJobs:s==="SINGLE"?1:a.maxConcurrentJobs}),children:[e.jsx(b,{children:e.jsx(S,{})}),e.jsxs(E,{children:[e.jsx(c,{value:"SINGLE",children:"Single Car"}),e.jsx(c,{value:"MULTIPLE",children:"Multiple Cars"})]})]})]}),a.carHandlingCapacity==="MULTIPLE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-maxConcurrentJobs",children:"Max Concurrent Jobs *"}),e.jsx(i,{id:"edit-maxConcurrentJobs",type:"number",min:"1",value:a.maxConcurrentJobs,onChange:s=>t({...a,maxConcurrentJobs:parseInt(s.target.value)||1}),required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-defaultLanguage",children:"Default Language"}),e.jsxs(y,{value:a.defaultLanguage,onValueChange:s=>t({...a,defaultLanguage:s}),children:[e.jsx(b,{children:e.jsx(S,{})}),e.jsxs(E,{children:[e.jsx(c,{value:"en",children:"English"}),e.jsx(c,{value:"es",children:"Spanish"}),e.jsx(c,{value:"ar",children:"Arabic"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(o,{type:"submit",children:"Update Business"})]})]})]})})]})}export{Be as default};
