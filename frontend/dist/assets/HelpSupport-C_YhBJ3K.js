import{j as e,a as b,u as d}from"./index-YmJ5rGxO.js";import{r as t}from"./vendor-redux-FsoCpCcR.js";import{C as m,a as W,b as z,c as K,d as p}from"./card-C1Os2Jzs.js";import{B as x}from"./button-BZ__ZVvs.js";import{I as v}from"./input-lKSy0GOu.js";import{L as h}from"./label-C0QsUGTD.js";import{T as ie}from"./textarea-CojeXS5Z.js";import{T as ce,a as ne,b as O,c as M}from"./tabs-ikx3-Flg.js";import{D as w,a as S,b as T,c as k,d as oe}from"./dialog-DioR_SNv.js";import{B as C}from"./badge-dOlDYKGI.js";import{S as de,a as me,b as pe,c as xe,d as D}from"./select-CkWAxkRE.js";import{p as he}from"./formUtils-CjVQbo5F.js";import{B as ue,G as je,M as fe}from"./message-square-BkapI-Xp.js";import{S as L}from"./search-yXlgkkGt.js";import{L as E}from"./loader-2-Z6OQyPns.js";import{c as ge}from"./createLucideIcon-BRnZLpr8.js";import{P as ye}from"./plus-BOAFu-8E.js";import{f as H}from"./format-CzBVktxt.js";import"./vendor-react-BGYP6dvN.js";import"./utils-Ckn0VQvi.js";import"./vendor-recharts-Bkxxru1U.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=ge("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),$={OPEN:"bg-sky-50 text-sky-700 border border-sky-100",IN_PROGRESS:"bg-amber-50 text-amber-700 border border-amber-100",RESOLVED:"bg-emerald-50 text-emerald-700 border border-emerald-100",CLOSED:"bg-slate-100 text-slate-700 border border-slate-200"},J={LOW:"bg-gray-500",MEDIUM:"bg-blue-500",HIGH:"bg-orange-500",URGENT:"bg-red-500"};function Be(){const[c,Q]=t.useState("help"),[I,X]=t.useState([]),[R,Z]=t.useState([]),[P,ee]=t.useState([]),[n,u]=t.useState(!0),[j,se]=t.useState(""),[f,te]=t.useState(""),[g,ae]=t.useState(""),[o,F]=t.useState(null),[i,A]=t.useState(null),[a,U]=t.useState(null),[re,y]=t.useState(!1),[_,B]=t.useState(!1),[l,N]=t.useState({subject:"",description:"",priority:"MEDIUM"}),G=async()=>{try{const s=new URLSearchParams;j.trim()&&s.set("search",j.trim()),f.trim()&&s.set("category",f.trim());const r=await b.get(`/admin/support/help-articles?${s}`);X(r.data.articles||[])}catch(s){d.error(s.response?.data?.message||"Failed to load help articles")}},q=async()=>{try{const s=new URLSearchParams;g.trim()&&s.set("search",g.trim());const r=await b.get(`/admin/support/tutorials?${s}`);Z(r.data.tutorials||[])}catch(s){d.error(s.response?.data?.message||"Failed to load tutorials")}},V=async()=>{try{const s=await b.get("/admin/support/tickets");ee(s.data.tickets||[])}catch(s){d.error(s.response?.data?.message||"Failed to load tickets")}};t.useEffect(()=>{u(!0),c==="help"?G().catch(()=>{}).finally(()=>u(!1)):c==="tutorials"?q().catch(()=>{}).finally(()=>u(!1)):c==="tickets"&&V().catch(()=>{}).finally(()=>u(!1))},[c]),t.useEffect(()=>{if(c==="help"){const s=setTimeout(()=>G(),300);return()=>clearTimeout(s)}},[j,f]),t.useEffect(()=>{if(c==="tutorials"){const s=setTimeout(()=>q(),300);return()=>clearTimeout(s)}},[g]);const le=async s=>{if(s?.preventDefault(),!l.subject?.trim()||!l.description?.trim()){d.error("Subject and description are required");return}B(!0);try{await b.post("/admin/support/tickets",l),d.success("Support ticket created. We will get back to you soon."),y(!1),N({subject:"",description:"",priority:"MEDIUM"}),V()}catch(r){d.error(r.response?.data?.message||"Failed to create ticket")}finally{B(!1)}};return e.jsxs("div",{className:"space-y-6 min-h-[400px]",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Help & Support"}),e.jsx("p",{className:"text-muted-foreground",children:"Search help articles, tutorials, or raise a support ticket"})]}),e.jsxs(ce,{value:c,onValueChange:Q,className:"w-full",children:[e.jsxs(ne,{className:"flex flex-wrap w-full sm:w-auto",children:[e.jsxs(O,{value:"help",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Help Center"]}),e.jsxs(O,{value:"tutorials",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Tutorials"]}),e.jsxs(O,{value:"tickets",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"My Tickets"]})]}),e.jsxs(M,{value:"help",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search by keyword...",value:j,onChange:s=>se(s.target.value),className:"pl-9"})]}),e.jsx(x,{type:"button",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10","aria-label":"Search",children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsx(v,{placeholder:"Filter by category",value:f,onChange:s=>te(s.target.value),className:"w-full sm:w-48"})})]}),n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:I.map(s=>e.jsxs(m,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>F(s),children:[e.jsxs(W,{className:"pb-2",children:[e.jsx(z,{className:"text-lg",children:s.title}),s.category&&e.jsx(K,{children:s.category})]}),e.jsx(p,{children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.content})})]},s._id))}),!n&&I.length===0&&e.jsx(m,{children:e.jsx(p,{className:"py-12 text-center text-muted-foreground",children:"No help articles found. Try a different search or ask your admin to add articles in Support."})})]}),e.jsxs(M,{value:"tutorials",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0 max-w-md",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search tutorials...",value:g,onChange:s=>ae(s.target.value),className:"pl-9"})]}),e.jsx(x,{type:"button",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10","aria-label":"Search",children:e.jsx(L,{className:"h-4 w-4"})})]}),n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:R.map(s=>e.jsxs(m,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>A(s),children:[e.jsx(W,{children:e.jsx(z,{className:"text-lg",children:s.title})}),e.jsxs(p,{children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),s.youtubeLink&&e.jsxs("span",{className:"inline-flex items-center text-xs text-primary mt-2",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"})," Video available"]})]})]},s._id))}),!n&&R.length===0&&e.jsx(m,{children:e.jsx(p,{className:"py-12 text-center text-muted-foreground",children:"No tutorials found. Try a different search or ask your admin to add tutorials in Support."})})]}),e.jsxs(M,{value:"tickets",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{onClick:()=>y(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"New Ticket"]})}),n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"space-y-3",children:P.map(s=>e.jsx(m,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>U(s),children:e.jsx(p,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:$[s.status],children:s.status.replace("_"," ")}),e.jsx(C,{className:J[s.priority],children:s.priority}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(new Date(s.createdAt),"MMM d, yyyy")})]})]})})},s._id))}),!n&&P.length===0&&e.jsx(m,{children:e.jsx(p,{className:"py-12 text-center text-muted-foreground",children:'You have no support tickets yet. Click "New Ticket" to get help.'})})]})]}),e.jsx(w,{open:!!o,onOpenChange:s=>!s&&F(null),children:e.jsxs(S,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsx(k,{children:o?.title}),o?.category&&e.jsx(K,{children:o.category})]}),o&&e.jsx("div",{className:"prose prose-sm max-w-none whitespace-pre-wrap text-slate-700",children:o.content})]})}),e.jsx(w,{open:!!i,onOpenChange:s=>!s&&A(null),children:e.jsxs(S,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(k,{children:i?.title})}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:i.description}),i.youtubeLink&&e.jsxs("a",{href:i.youtubeLink,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-primary hover:underline",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"})," Watch video"]}),i.steps?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Steps"}),e.jsx("ol",{className:"list-decimal list-inside space-y-2",children:i.steps.sort((s,r)=>(s.order||0)-(r.order||0)).map((s,r)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground ml-6",children:s.description})]},r))})]})]})]})}),e.jsx(w,{open:!!a,onOpenChange:s=>!s&&U(null),children:e.jsxs(S,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsxs(k,{children:["Ticket: ",a?.subject]}),e.jsx("div",{className:"flex gap-2",children:a&&e.jsxs(e.Fragment,{children:[e.jsx(C,{className:$[a.status],children:a.status.replace("_"," ")}),e.jsx(C,{className:J[a.priority],children:a.priority}),e.jsx("span",{className:"text-sm text-muted-foreground",children:H(new Date(a.createdAt),"PPp")})]})})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Description"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:a.description})]}),a.replies?.length>0&&e.jsxs("div",{children:[e.jsx(h,{className:"text-muted-foreground",children:"Replies"}),e.jsx("div",{className:"mt-2 space-y-3 border-l-2 border-muted pl-4",children:a.replies.map((s,r)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.repliedBy?.email??"Support"," Â· ",s.repliedAt?H(new Date(s.repliedAt),"PPp"):""]})]},r))})]})]})]})}),e.jsx(w,{open:re,onOpenChange:y,children:e.jsxs(S,{children:[e.jsxs(T,{children:[e.jsx(k,{children:"Raise Support Ticket"}),e.jsx(oe,{children:"Describe your issue. Our team will respond as soon as possible."})]}),e.jsxs("form",{onSubmit:le,onKeyDown:he,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"subject",children:"Subject *"}),e.jsx(v,{id:"subject",value:l.subject,onChange:s=>N({...l,subject:s.target.value}),placeholder:"Brief summary of your issue",required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"priority",children:"Priority"}),e.jsxs(de,{value:l.priority,onValueChange:s=>N({...l,priority:s}),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsxs(xe,{children:[e.jsx(D,{value:"LOW",children:"Low"}),e.jsx(D,{value:"MEDIUM",children:"Medium"}),e.jsx(D,{value:"HIGH",children:"High"}),e.jsx(D,{value:"URGENT",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Description *"}),e.jsx(ie,{id:"description",value:l.description,onChange:s=>N({...l,description:s.target.value}),placeholder:"Describe your issue in detail...",rows:5,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(x,{type:"submit",disabled:_,children:[_?e.jsx(E,{className:"h-4 w-4 animate-spin mr-2"}):null,"Submit Ticket"]})]})]})]})})]})}export{Be as default};
